<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts</title>
</head>
<body>
    <h1>Posts</h1>

    <form method="GET" action="{% url 'search_post' %}">
        <input type="text" name="post_name" placeholder="Search for a post" required>
        <button type="submit">Search</button>
    </form>
    
    <form method="GET" action="{% url 'get_posts' %}">
        <label for="tag">Enter a tag:</label>
        <input type="text" name="tag" placeholder="Type your tag here..." required>
        <button type="submit">Search</button>
    </form>

    {% if posts %}
    <ul>
        {% for post in posts %}
            <li>
                <h2>{{ post.title }}</h2>
                <p>Tags: 
                    {% for tag in post.post_tags %}
                        {{ tag.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
                <p>{{ post.body }}</p>
                <p><strong>Author:</strong> {{ post.author.name }}</p>
                <p><strong>Created At:</strong> {{ post.created_at }}</p>
                <p><strong>Last Updated At:</strong> {{ post.updated_at }}</p>
                <p><strong>Likes:</strong> {{ post.likes_count }}</p>
                <p><strong>Comments:</strong> {{ post.comments_count }}</p>

                <form method="POST" action="{% url 'delete_edit_post' post.id %}" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="delete" value="true"> 
                    <button type="submit">Delete</button>
                </form>
                
                
                <a href="{% url 'delete_edit_post' post.id %}?edit=true">Edit</a>
                <a href="{% url 'like_post' post.id %}">Like</a>
                
                <!-- Comment Section -->
                <h3>Leave a Comment:</h3>
                <form method="POST" action="{% url 'comment_post' post.id %}">
                    {% csrf_token %}
                    <textarea name="body" placeholder="Write your comment here..." required></textarea>
                    <button type="submit">Comment</button>
                </form>
                
                <h4>Comments:</h4>
                <ul>
                    {% for comment in post.comment_set.all %}
                        <li>
                            <strong>{{ comment.author.name }}:</strong> {{ comment.body }} 
                            <em>at {{ comment.created_at }}</em>

                            {% if comment.author == request.user %}
                                <a href="{% url 'edit_comment' comment.id %}">Edit</a>
                                <form method="POST" action="{% url 'delete_comment' comment.id %}">
                                    {% csrf_token %}
                                    <button type="submit">Delete</button>
                                </form>
                                
                            {% endif %}
                        </li>
                    {% empty %}
                        <li>No comments yet.</li>
                    {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No posts available.</p>
{% endif %}

</body>
</html>
